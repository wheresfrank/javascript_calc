<!DOCTYPE html>
<html lang="en">
<html>
    <head>
        <title>Calcatron</title>
        <link rel=stylesheet href="style.css" type="text/css">
        <script src="script.js"></script>
        <meta charset="utf-8"/>
    </head>
    <body>
        <div id="calc">
            <div id="calcTop">
                <div id="screen"></div>
                <div id="subscreen"></div>
            </div>
            <div id="calcBottom">
                <button id="btnNegative" class="numBtn lt" onclick="buttonNegative('7')">+/-</button>
                <button id="btnPercent" class="numBtn md" onclick="buttonPercent()">%</button>
                <button id="btnBS" class="numBtn md" onclick="buttonBS()">&#x2B05;</button>
                <button id="btnClear" class="btn" onclick="buttonClear()">CLEAR</button>
                <button id="btn7" class="numBtn lt" onclick="buttonNumber('7')">7</button>
                <button id="btn8" class="numBtn md" onclick="buttonNumber('8')">8</button>
                <button id="btn9" class="numBtn md" onclick="buttonNumber('9')">9</button>
                <button id="btnDiv" class="optBtn" onclick="buttonOperator('divide')">รท</button>
                <button id="btn4" class="numBtn lt" onclick="buttonNumber('4')">4</button>
                <button id="btn5" class="numBtn md" onclick="buttonNumber('5')">5</button>
                <button id="btn6" class="numBtn md" onclick="buttonNumber('6')">6</button>
                <button id="btnMult" class="optBtn" onclick="buttonOperator('multiply')">x</button>
                <button id="btn1" class="numBtn lt" onclick="buttonNumber('1')">1</button>
                <button id="btn2" class="numBtn md" onclick="buttonNumber('2')">2</button>
                <button id="btn3" class="numBtn md" onclick="buttonNumber('3')">3</button>
                <button id="btnSub" class="optBtn" onclick="buttonOperator('subtract')">-</button>
                <button id="btn0" class="numBtn lt" onclick="buttonNumber('0')">0</button>
                <button id="btnDec" class="numBtn md" onclick="buttonDecimal()">.</button>
                <button id="btnEqual" class="btn" onclick="buttonEqual()">=</button>
                <button id="btnPlus" class="optBtn" onclick="buttonOperator('add')">+</button>      </div>
        </div>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
 
<script type="text/discourse-plugin" version="0.8.18">

    let xhReq = new XMLHttpRequest();
    xhReq.open("GET", '/u/' + api.getCurrentUser().username + '/emails.json', false);
    xhReq.send(null);
    let jsonObject = JSON.parse(xhReq.responseText);
    let userEmail = jsonObject.email;

    (function(w, d, x, id){
        let s=d.createElement('script');
        s.src='https://dg9yx063wiiht.cloudfront.net/amazon-connect-chat-interface-client.js';
        s.async=1;
        s.id=id;
        d.getElementsByTagName('head')[0].appendChild(s);
        w[x] =  w[x] || function() { (w[x].ac = w[x].ac || []).push(arguments) };
    })
        (window, document, 'amazon_connect', 'fa1dc171-179f-4e1f-8d53-8a3a7f6e8860');
        amazon_connect('styles', { openChat: { color: 'white', backgroundColor: '#08A4AB'}, closeChat: { color: 'white', backgroundColor: '#08A4AB'} });
        amazon_connect('snippetId', 'QVFJREFIaUpTVGJkNWhNc0Q1WHpHYnFQTkJyYXN0TENLbGdHZzNOenF2d2RJblBkYlFHZ3YwZ0dGRVdaUWJsRmROMW5OQTNSQUFBQWJqQnNCZ2txaGtpRzl3MEJCd2FnWHpCZEFnRUFNRmdHQ1NxR1NJYjNEUUVIQVRBZUJnbGdoa2dCWlFNRUFTNHdFUVFNQWYyUFZtZmszTjgvYWRSb0FnRVFnQ3Y1YnpRb2VJQlVHZEc5NmpvK1RRNDZWcythRXRrM21mQlE5Sk5OOXNESmlVc2xMcEdGcFE1QVpxOG06OmNBcWFQdXNGaVc0bGo0MnpMV29KQlRzbXk4NTNyVVdFclYrWGNxMlMyYmttUVZBMkpFTGEvOGtFNE4rbklhcFhWWmlqNDNQMkFGVklsY0l6TmY3Q29WRklVa2dFYmRYQXZsOTcwMFkweFpFZDNVTGJVMjBhK2hXWGhGRHZXeWhsRkFCU0J2SHZvWXBMbDlVVUYwTDVLNkhyNVhtZ2NHRT0=');
        amazon_connect('supportedMessagingContentTypes', [ 'text/plain', 'text/markdown' ]);
        amazon_connect('customerDisplayName', function(callback) {
            const displayName = api.getCurrentUser().name;
            callback(displayName)});
    
    let name = api.getCurrentUser().name
    let firstName = name.split(" ")[0]
         
    let ac_secret = "r1MbDrwWg9+6ztX19ytwhKXOTpOg6rE5epmTsG5Tyck="     
    let header = {
      'typ': "JWT",
      'alg': 'HS256'
    }

    let payload = {
      'sub': 'fa1dc171-179f-4e1f-8d53-8a3a7f6e8860',
      'iat': + new Date(),
      'exp': + new Date() + 500,
      'attributes': {"first_name": firstName, "name": name, "email": userEmail }
    }
     
    function base64url(source) {
      // Encode in classical base64
      var encodedSource = CryptoJS.enc.Base64.stringify(source);
       
      // Remove padding equal characters
      encodedSource = encodedSource.replace(/=+$/, '');
       
      // Replace characters according to base64url specifications
      encodedSource = encodedSource.replace(/\+/g, '-');
      encodedSource = encodedSource.replace(/\//g, '_');
       
      return encodedSource;
    }
     
    let stringifiedHeader = CryptoJS.enc.Utf8.parse(JSON.stringify(header));
    let encodedHeader = base64url(stringifiedHeader);
     
    let stringifiedPayload = CryptoJS.enc.Utf8.parse(JSON.stringify(payload));
    let encodedData = base64url(stringifiedPayload);
     
    var token = encodedHeader + "." + encodedData;
     
    let signature = CryptoJS.HmacSHA256(token, ac_secret);
        signature = base64url(signature);
 
    let  signedToken = token + "." + signature;
     
    amazon_connect('authenticate', function(callback) {
        callback(signedToken);
    });

</script>
        <footer>
        Created by Frank Johnette for <a href="https://www.theodinproject.com" target="_blank">The Odin Project</a>
        </footer>

    </body>
</html>
